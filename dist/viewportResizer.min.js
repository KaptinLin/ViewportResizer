/*! ViewportResizer - v0.1.0 - 2012-10-08
* https://github.com/KaptinLin/ViewportResizer
* Copyright (c) 2012 KaptinLin; Licensed GPL */
(function(e,t,n,r){"use strict";var i=n.ViewportResizer=function(t){function b(){s.build(),o.build(),a.build(),s.bind(),a.bind(),u.init(i.settings.target)}function w(e,t){s.to(e),o.to(e),t!==!1&&(n.extend(i.query,{viewport:e}),u.pushState(i.query))}function E(e){return{width:i.settings.sizes[e].width,height:i.settings.sizes[e].height}}function S(){var e=jQuery('<div style="width: 100%; height:200px;">test</div>'),t=jQuery('<div style="width:200px; height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(e),n=e[0],r=t[0];jQuery("body").append(r);var i=n.offsetWidth;t.css("overflow","scroll");var s=r.clientWidth;return t.remove(),i-s}n.extend(i.settings,t);var s,o,u,a,f=S(),l=i.settings.classNamePrefix+"-switcher",c=i.settings.classNamePrefix+"-viewport",h=i.settings.classNamePrefix+"-width-area",p=i.settings.classNamePrefix+"-height-area",d=i.settings.classNamePrefix+"-iframe",v=i.settings.classNamePrefix+"-width-resizer",m=i.settings.classNamePrefix+"-height-resizer",g=i.settings.classNamePrefix+"-overlay",y=i.settings.classNamePrefix+"-height-overlay";i.query={},e.onpopstate=function(e){e.state!==null&&e.state.viewport!==r&&w(e.state.viewport,!1)},u={init:function(e){n.extend(i.query,u.getQuery()),i.query.viewport!==r&&i.settings.sizes[i.query.viewport]!==r&&w(i.query.viewport,!1),i.query.target!==r?o.load(i.query.target):e!==r&&o.load(e)},pushState:function(t){if(e.history&&e.history.pushState&&e.history.replaceState){var r=[];n.each(t,function(e,t){r.push(e+"="+t)});var i="?"+r.join("&");e.history.pushState(t,"",i)}},getQuery:function(t){t===r&&(t=e.location.href);var i={},s=t.replace(/#[^\s]+/,"").split("?")[1];return s!==r&&(s=s.split("&"),n.each(s,function(e,t){var n=t.split("=");i[n[0]]=n[1]})),i}},s={build:function(){i.$switcher=n("<ul/>").addClass(l);var e=[];n.each(i.settings.sizes,function(t,n){e+="<li data-size='"+t+"' class='"+l+"-"+t+"'><a href='#'>"+n.description+"</a></li>"}),i.$switcher.append(e).appendTo(i.settings.container.switcher),i.$sizes=i.$switcher.find("li")},to:function(e){i.$sizes.filter('[data-current="true"]').attr("data-current",null),i.$sizes.filter('[data-size="'+e+'"]').attr("data-current","true")},bind:function(){i.$sizes.click(function(){w(n(this).data("size"))})}},o={build:function(){i.$viewport=n("<div />").addClass(c).appendTo(i.settings.container.viewport),i.$widthArea=n("<div />").addClass(h).appendTo(i.$viewport),i.$iframe=n("<iframe />").addClass(d).appendTo(i.$widthArea)},load:function(e){-1===e.search(/http(s){0,1}:\/\//)&&(e="http://"+e),i.$iframe.attr("src",e)},to:function(e){var t=E(e),n=t.width+f;i.$widthArea.css({width:n}),i.$iframe.css({height:t.height}),i.$heightResizer.css({top:t.height})}},a={build:function(){i.$widthResizer=n("<div />").addClass(v).prependTo(i.$widthArea),i.$overlay=n("<div />").addClass(g).prependTo(i.$widthArea),i.$heightResizer=n("<div />").addClass(m).appendTo(i.$viewport)},bind:function(){i.$widthArea.drag("start",function(e,t){i.$overlay.show(),t.width=this.clientWidth,i.$viewport.attr("data-onResizing","true")}).drag(function(e,t){this.style.width=Math.max(i.settings.resize.minWidth,t.width+t.deltaX*2)+"px"},{handle:"."+v}).drag("dragend",function(e,t){i.$overlay.hide(),i.$viewport.attr("data-onResizing",null)}),i.$viewport.drag("start",function(e,t){i.$overlay.show(),t.height=i.$iframe[0].clientHeight,i.$viewport.attr("data-onResizing","true")}).drag(function(e,t){i.$iframe[0].style.height=Math.max(i.settings.resize.minHeight,t.height+t.deltaY)+"px",i.$heightResizer[0].style.top=i.$iframe[0].style.height},{handle:"."+m}).drag("dragend",function(e,t){i.$overlay.hide(),i.$viewport.attr("data-onResizing",null)})}},b()};i.settings={classNamePrefix:"resizer",container:{switcher:"header",viewport:"article"},sizes:{mobile:{width:320,height:480,description:"Mobile"},tablet:{width:460,height:640,description:"Tablet"},notebook:{width:768,height:1024,description:"Notebook"},desktop:{width:1200,height:800,description:"Desktop"}},resize:{minWidth:240,minHeight:320}},i.addSize=function(e,t){i.sizes.slug=t}})(window,document,jQuery);