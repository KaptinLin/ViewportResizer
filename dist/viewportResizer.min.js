/*! ViewportResizer - v0.2.1 - 2012-10-31
* https://github.com/KaptinLin/ViewportResizer
* Copyright (c) 2012 KaptinLin; Licensed CC BY-NC 3.0 */
(function(e,t,n,r){"use strict";function i(e){return(typeof e=="string"||typeof e=="number")&&!isNaN(e-0)&&e!==""}function s(e){if(i(e))return e/2;if(typeof e=="string"&&e.charAt(e.length-1)==="%")return e.substr(0,e.length-1)/2+"%"}function o(){var e=jQuery('<div style="width: 100%; height:200px;">test</div>'),t=jQuery('<div style="width:200px; height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(e),n=e[0],r=t[0];jQuery("body").append(r);var i=n.offsetWidth;t.css("overflow","scroll");var s=r.clientWidth;return t.remove(),i-s}var u=n.ViewportResizer=function(t){function S(){u.$viewport=n("<div />").addClass(m).appendTo(u.settings.container.viewport),u.$viewport.on("go",function(e,t){if(typeof t=="undefined")return;typeof t.viewport!="undefined"&&(u.current.viewport=t.viewport,t.viewport!=="optional"&&(t.dimensions=x(t.viewport)),u.current.width=t.dimensions.width,u.current.height=t.dimensions.height),u.$viewport.trigger("resize",u.current)}),u.current={},u.settings.components.target&&p.init(),u.settings.components.switcher&&r.init(),u.settings.components.iframe&&a.init(),u.settings.components.resizable&&l.init(),u.settings.components.axis&&c.init(),u.settings.components.info&&h.init(),u.$viewport.attr("data-current","auto"),f.init()}function x(e){return e==="auto"?{width:"100%",height:"100%"}:{width:u.settings.viewports[e].width,height:u.settings.viewports[e].height}}n.extend(!0,u.settings,t);var r,a,f,l,c,h,p,d=o(),v=u.settings.classNamePrefix+"-switcher",m=u.settings.classNamePrefix+"-viewport",g=u.settings.classNamePrefix+"-iframe",y=u.settings.classNamePrefix+"-resizable",b=u.settings.classNamePrefix+"-axis",w=u.settings.classNamePrefix+"-info",E=u.settings.classNamePrefix+"-target";u.query={},f={init:function(t){n.extend(u.query,f.getQuery()),f.go(u.query),e.onpopstate=function(t){e.onpopstateing=!0,t.state!==null&&f.go(t.state),e.onpopstateing=!1,t.preventDefault()},u.$viewport.on("go",function(e,t){if(typeof t=="undefined")return;typeof t.viewport!="undefined"&&(t.viewport==="optional"&&t.dimensions!=="undefined"?f.setQuery({viewport:t.viewport,width:t.dimensions.width,height:t.dimensions.height}):u.query.viewport!==t.viewport&&f.setQuery({viewport:t.viewport,width:null,height:null}))})},go:function(e){var t={};typeof e.viewport!="undefined"&&(e.viewport==="optional"?(t.dimensions={width:e.width?parseInt(e.width,10):u.settings.min.width,height:e.height?parseInt(e.height,10):u.settings.min.height},t.viewport="optional"):typeof u.settings.viewports[e.viewport]!="undefined"&&(t.viewport=e.viewport)),typeof e.target!="undefined"?t.url=e.target:typeof u.settings.target!="undefined"&&(t.url=u.settings.target),t!=={}&&u.$viewport.trigger("go",t)},pushState:function(t){if(e.onpopstateing===!0)return;if(e.history&&e.history.pushState&&e.history.replaceState){var r=[];n.each(t,function(e,t){t!=null&&r.push(e+"="+t)});var i="?"+r.join("&");e.history.pushState(t,"",i)}},getQuery:function(t){typeof t=="undefined"&&(t=e.location.href);var r={},i=t.replace(/#[^\s]+/,"").split("?")[1];return typeof i!="undefined"&&(i=i.split("&"),n.each(i,function(e,t){var n=t.split("=");r[n[0]]=n[1]})),r},setQuery:function(e){e=n.extend(u.query,e),f.pushState(e)}},p={init:function(){p.build(),p.bind()},build:function(){u.$target=n("<div/>").addClass(E),p.input=n('<input type="text"/>').addClass(E+"-input").val(u.settings.targetPlaceholder).appendTo(u.$target),p.enter=n("<span/>").addClass(E+"-enter").appendTo(u.$target),u.$target.appendTo(u.settings.container.target)},bind:function(){p.input.on("focus",function(){this.value===u.settings.targetPlaceholder&&(this.value="")}).on("blur",function(){this.value===""&&(this.value=u.settings.targetPlaceholder)}),p.input.on("change",function(){p.go(this.value)}),p.input.autoGrowInput({comfortZone:15,maxWidth:2e3}),u.$viewport.on("go",function(e,t){if(typeof t=="undefined")return;typeof t.url!="undefined"&&p.set(t.url)})},set:function(e){p.input.val(e),p.input.trigger("update")},go:function(e){a.load(e)}},r={init:function(){r.build(),r.bind(),r.optional.build(),r.optional.bind()},optional:{build:function(){r.$optional=u.$switcher.children('[data-viewport="optional"]'),r.optional.$container=n("<div/>").addClass(v+"-optional-container"),r.optional.$custom=n("<div class='"+v+"-optional-add'>"+"<div><label for='optional_width'>Width:</label><input type='number' id='optional_width' min='"+u.settings.min.width+"' value='' /></div>"+"<div><label for='optional_height'>Height:</label><input type='number' id='optional_height' min='"+u.settings.min.height+"' value='' /></div>"+"<div><button id='optional_add'>Add</button>"+"</div>").appendTo(r.optional.$container),r.optional.$width=r.optional.$custom.find("#optional_width"),r.optional.$height=r.optional.$custom.find("#optional_height"),r.optional.$add=r.optional.$custom.find("#optional_add"),r.optional.$saved=n("<ul/>").appendTo(r.optional.$container),r.optional.$container.appendTo(r.$optional)},activeMatch:function(e,t){var i=!1;return n(r.optional.$saved).children().each(function(){parseInt(n(this).data("width"),10)===e.width&&parseInt(n(this).data("height"),10)===e.height&&(n(this).trigger("click"),i=!0)}),i},addToSaved:function(e){i(e.width)&&i(e.height)&&r.optional.activeMatch(e)===!1&&n("<li><div><span>Width: </span><span>"+e.width+"</span></div><div><span>Height: </span><span>"+e.height+"</span></div><div><button>Delete</button></div></li>").data("width",e.width).data("height",e.height).appendTo(r.optional.$saved).trigger("click")},active:function(e){n(e).attr("data-current","true"),n(e).siblings('[data-current="true"]').attr("data-current",null);var t=parseInt(n(e).data("width"),10),i=parseInt(n(e).data("height"),10);r.to("optional",{width:t,height:i})},deactive:function(){r.optional.$saved.find('[data-current="true"]').attr("data-current",null)},bind:function(){r.$optional.hover(function(e){r.$optional.attr("data-show","true"),i(u.current.width)&&r.optional.$width.val(u.current.width),i(u.current.height)&&r.optional.$height.val(u.current.height)},function(e){r.$optional.attr("data-show","false")}),r.optional.$width.on("change",function(){i(this.value)&&(this.value<u.settings.min.width&&(this.value=u.settings.min.width),u.$viewport.trigger("resize",{width:this.value}))}),r.optional.$height.on("change",function(){i(this.value)&&(this.value<u.settings.min.height&&(this.value=u.settings.min.height),u.$viewport.trigger("resize",{height:this.value}))}),r.optional.$add.on("click",function(){r.optional.addToSaved({width:r.optional.$width.val(),height:r.optional.$height.val()})}),r.optional.$saved.delegate("button","click",function(e){n(this).closest("li").remove()}),r.optional.$saved.delegate("li","click",function(e){r.optional.active(this)}),u.$viewport.on("go",function(e,t){if(typeof t=="undefined")return;typeof t.viewport!="undefined"&&(t.viewport==="optional"&&typeof t.dimensions!="undefined"?(r.to("optional",t.dimensions),r.optional.activeMatch(t.dimensions)):r.to(t.viewport))})}},build:function(){u.$switcher=n("<ul/>").addClass(v);var e=[];n.each(u.settings.viewports,function(t,n){e+="<li data-viewport='"+t+"' class='"+v+"-"+t+"'><a href='#'>"+n.description+"</a></li>"}),u.$switcher.append(e).appendTo(u.settings.container.switcher)},to:function(e,t){e!=="optional"&&r.optional.deactive(),u.$switcher.children('[data-current="true"]').attr("data-current",null),u.$switcher.children('[data-viewport="'+e+'"]').attr("data-current","true")},bind:function(){u.$switcher.delegate("a","click",function(e){var t=n(this).parent().data("viewport");t!=="optional"&&u.$viewport.trigger("go",{viewport:t}),e.preventDefault()})}},a={init:function(){a.build(),a.bind()},build:function(){u.$iframe=n('<iframe frameborder="no"/>').addClass(g).appendTo(u.$viewport)},bind:function(){u.$viewport.delegate(u.$iframe,"resize",function(e,t){if(typeof t=="undefined")return;var n={};typeof t.width!="undefined"&&(u.settings.scrollbarInWidth||!i(t.width)?n.width=t.width:n.width=t.width+d,u.current.width=t.width),typeof t.height!="undefined"&&(n.height=t.height,u.current.height=t.height),e.data.css(n)}),u.$viewport.on("go",function(e,t){if(typeof t=="undefined")return;typeof t.url!="undefined"&&a.load(t.url)})},load:function(e){-1===e.search(/http(s){0,1}:\/\//)&&(e="http://"+e),u.$iframe.attr("src",e),u.query.target!==e&&f.setQuery({target:e})}},h={init:function(){h.build(),h.bind()},build:function(){u.$info=n('<div><div class="'+w+'-width"><span class="'+w+'-lable">Width: </span><span class="'+w+'-value"></span></div>'+'<div class="'+w+'-height"><span class="'+w+'-lable">Height: </span><span class="'+w+'-value"></span></div>'+"</div>").addClass(w).appendTo(u.$viewport),u.$infoWidth=u.$info.find("."+w+"-width ."+w+"-value"),u.$infoHeight=u.$info.find("."+w+"-height ."+w+"-value")},bind:function(){u.$viewport.delegate(u.$info,"resize",function(e,t){if(typeof t=="undefined")return;var n={};typeof t.width!="undefined"&&(n.marginLeft=s(t.width),u.$infoWidth.text(t.width)),typeof t.height!="undefined"&&(n.top=t.height,u.$infoHeight.text(t.height)),e.data.css(n)})}},c={init:function(){c.build(),c.bind()},build:function(){u.$axis=n("<div />").addClass(b),u.$axisX=n("<div />").addClass(b+"-x").prependTo(u.$axis),u.$axisY=n("<div />").addClass(b+"-y").prependTo(u.$axis),u.$axis.prependTo(u.$viewport)},bind:function(){u.$viewport.delegate(u.$axisX,"resize",function(e,t){if(typeof t=="undefined")return;if(typeof t.width!="undefined"){var n=t.width;if(!u.settings.scrollbarInWidth||!i(t.width))n=t.width+d;e.data.css({marginLeft:s(n)})}}),u.$viewport.delegate(u.$axisY,"resize",function(e,t){if(typeof t=="undefined")return;typeof t.height!="undefined"&&e.data.css({top:t.height})})}},l={init:function(){l.build(),l.bind()},build:function(){u.$resizable=n("<div />").addClass(y),u.$resizableX=n("<div />").addClass(y+"-x").prependTo(u.$resizable),u.$resizableY=n("<div />").addClass(y+"-y").prependTo(u.$resizable),u.$resizableXY=n("<div />").addClass(y+"-xy").prependTo(u.$resizable),u.$resizable.appendTo(u.$viewport)},bind:function(){u.$viewport.delegate(u.$resizable,"resize",function(e,t){if(typeof t=="undefined")return;var n={};if(typeof t.width!="undefined"){var r=t.width;if(!u.settings.scrollbarInWidth||!i(t.width))r=t.width+d;n.width=r,n.marginLeft=s("-"+r)}typeof t.height!="undefined"&&(n.height=t.height),e.data.css(n)}),u.$resizableX.drag("start",function(e,t){t.width=u.current.width,u.$viewport.attr("data-resizing","onx")}).drag(function(e,t){u.$viewport.trigger("resize",{width:Math.max(u.settings.min.width,t.width+parseInt(t.deltaX,10)*2)})}).drag("dragend",function(e,t){u.$viewport.attr("data-resizing",null)}),u.$resizableY.drag("start",function(e,t){t.height=u.current.height,u.$viewport.attr("data-resizing","ony")}).drag(function(e,t){u.$viewport.trigger("resize",{height:Math.max(u.settings.min.height,t.height+parseInt(t.deltaY,10))})}).drag("dragend",function(e,t){u.$viewport.attr("data-resizing",null)}),u.$resizableXY.drag("start",function(e,t){t.width=u.current.width,t.height=u.current.height,u.$viewport.attr("data-resizing","onxy")}).drag(function(e,t){u.$viewport.trigger("resize",{width:Math.max(u.settings.min.width,t.width+parseInt(t.deltaX,10)*2),height:Math.max(u.settings.min.height,t.height+parseInt(t.deltaY,10))})}).drag("dragend",function(e,t){u.$viewport.attr("data-resizing",null)})}},S()};u.settings={components:{target:!0,switcher:!0,iframe:!0,resizable:!0,axis:!0,info:!0},classNamePrefix:"resizer",container:{switcher:"header",target:"header",viewport:"article"},viewports:{auto:{width:"100%",height:"100%",description:"Auto"},optional:{description:"Optional"},mobile:{width:320,height:480,description:"Mobile"},tablet:{width:480,height:640,description:"Tablet"},notebook:{width:768,height:1024,description:"Notebook"},desktop:{width:1200,height:800,description:"Desktop"}},min:{width:240,height:320},step:5,targetPlaceholder:"Type your url here",scrollbarInWidth:!0,target:r},u.addViewport=function(e,t){u.viewports.slug=t}})(window,document,jQuery),function(e,t,n){t.fn.autoGrowInput=function(e){return e=t.extend({maxWidth:1e3,minWidth:0,comfortZone:70},e),this.filter("input:text").each(function(){var n=e.minWidth||t(this).width(),r="",i=t(this),s=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),u=function(){if(r===(r=i.val()))return;var t=r.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");s.html(t);var u=s.width(),a=u+e.comfortZone>=n?u+e.comfortZone:n,f=i.width(),l=a<f&&a>=n||a>n&&a<e.maxWidth;l&&i.width(a)};s.insertAfter(i),t(this).bind("keyup keydown blur update",u)}),this}}(document,jQuery);