/*! ViewportResizer - v0.1.0 - 2012-10-11
* https://github.com/KaptinLin/ViewportResizer
* Copyright (c) 2012 KaptinLin; Licensed GPL */
(function(e,t,n,r){"use strict";var i=n.ViewportResizer=function(t){function y(){i.$viewport=n("<div />").addClass(p).appendTo(i.settings.container.viewport),i.current={},s.build(),o.build(),a.build(),f.build(),l.build(),s.bind(),o.bind(),a.bind(),f.bind(),l.bind(),u.init(i.settings.target),i.$viewport.attr("data-current","auto")}function b(e){return{width:i.settings.viewports[e].width+c,height:i.settings.viewports[e].height}}function w(){var e=jQuery('<div style="width: 100%; height:200px;">test</div>'),t=jQuery('<div style="width:200px; height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(e),n=e[0],r=t[0];jQuery("body").append(r);var i=n.offsetWidth;t.css("overflow","scroll");var s=r.clientWidth;return t.remove(),i-s}n.extend(i.settings,t);var s,o,u,a,f,l,c=w(),h=i.settings.classNamePrefix+"-switcher",p=i.settings.classNamePrefix+"-viewport",d=i.settings.classNamePrefix+"-iframe",v=i.settings.classNamePrefix+"-resizable",m=i.settings.classNamePrefix+"-axis",g=i.settings.classNamePrefix+"-info";i.query={},e.onpopstate=function(e){e.state!==null&&e.state.viewport!==r&&switchTo(e.state.viewport,!1)},u={init:function(e){n.extend(i.query,u.getQuery()),i.query.viewport!==r&&i.settings.viewports[i.query.viewport]!==r&&s.to(i.query.viewport),i.query.target!==r?o.load(i.query.target):e!==r&&o.load(e)},pushState:function(t){if(e.history&&e.history.pushState&&e.history.replaceState){var r=[];n.each(t,function(e,t){r.push(e+"="+t)});var i="?"+r.join("&");e.history.pushState(t,"",i)}},getQuery:function(t){t===r&&(t=e.location.href);var i={},s=t.replace(/#[^\s]+/,"").split("?")[1];return s!==r&&(s=s.split("&"),n.each(s,function(e,t){var n=t.split("=");i[n[0]]=n[1]})),i}},s={build:function(){i.$switcher=n("<ul/>").addClass(h);var e=[];n.each(i.settings.viewports,function(t,n){e+="<li data-viewport='"+t+"' class='"+h+"-"+t+"'><a href='#'>"+n.description+"</a></li>"}),i.$switcher.append(e).appendTo(i.settings.container.switcher),i.$switcherItem=i.$switcher.find("li")},to:function(e){i.current.viewport=e;var t=b(i.current.viewport);i.current.width=t.width,i.current.height=t.height,i.$switcherItem.filter('[data-current="true"]').attr("data-current",null),i.$switcherItem.filter('[data-viewport="'+e+'"]').attr("data-current","true"),i.$viewport.trigger("resize",i.current)},bind:function(){i.$switcherItem.click(function(){var e=n(this).data("viewport");s.to(e)})}},o={build:function(){i.$iframe=n("<iframe />").addClass(d).appendTo(i.$viewport)},bind:function(){i.$viewport.delegate(i.$iframe,"resize",function(e,t){var n={};r!=t.width&&(n.width=t.width,i.current.width=t.width),r!=t.height&&(n.height=t.height,i.current.height=t.height),e.data.css(n)})},load:function(e){-1===e.search(/http(s){0,1}:\/\//)&&(e="http://"+e),i.$iframe.attr("src",e)}},l={build:function(){i.$info=n('<div><div class="'+g+'-width"><span class="'+g+'-lable">Width: </span><span class="'+g+'-value"></span></div>'+'<div class="'+g+'-height"><span class="'+g+'-lable">Height: </span><span class="'+g+'-value"></span></div>'+"</div>").addClass(g).appendTo(i.$viewport),i.$infoWidth=i.$info.find("."+g+"-width ."+g+"-value"),i.$infoHeight=i.$info.find("."+g+"-height ."+g+"-value")},bind:function(){i.$viewport.delegate(i.$info,"resize",function(e,t){var n={};r!=t.width&&(n.marginLeft=t.width/2,i.$infoWidth.text(t.width-c)),r!=t.height&&(n.top=t.height,i.$infoHeight.text(t.height)),e.data.css(n)})}},f={build:function(){i.$axis=n("<div />").addClass(m),i.$axisX=n("<div />").addClass(m+"-x").prependTo(i.$axis),i.$axisY=n("<div />").addClass(m+"-y").prependTo(i.$axis),i.$axis.prependTo(i.$viewport)},bind:function(){i.$viewport.delegate(i.$axisX,"resize",function(e,t){r!=t.width&&e.data.css({marginLeft:t.width/2})}),i.$viewport.delegate(i.$axisY,"resize",function(e,t){r!=t.height&&e.data.css({top:t.height})})}},a={build:function(){i.$resizable=n("<div />").addClass(v),i.$resizableX=n("<div />").addClass(v+"-x").prependTo(i.$resizable),i.$resizableY=n("<div />").addClass(v+"-y").prependTo(i.$resizable),i.$resizableXY=n("<div />").addClass(v+"-xy").prependTo(i.$resizable),i.$resizable.prependTo(i.$viewport)},bind:function(){i.$viewport.delegate(i.$resizable,"resize",function(e,t){var n={};r!=t.width&&(n.width=t.width,n.marginLeft=-t.width/2),r!=t.height&&(n.height=t.height),e.data.css(n)}),i.$resizableX.drag("start",function(e,t){t.width=i.current.width,i.$viewport.attr("data-resizing","onx")}).drag(function(e,t){i.$viewport.trigger("resize",{width:Math.max(i.settings.resize.minWidth,t.width+t.deltaX*2)})}).drag("dragend",function(e,t){i.$viewport.attr("data-resizing",null)}),i.$resizableY.drag("start",function(e,t){t.height=i.current.height,i.$viewport.attr("data-resizing","ony")}).drag(function(e,t){i.$viewport.trigger("resize",{height:Math.max(i.settings.resize.minHeight,t.height+t.deltaY)})}).drag("dragend",function(e,t){i.$viewport.attr("data-resizing",null)}),i.$resizableXY.drag("start",function(e,t){t.width=i.current.width,t.height=i.current.height,i.$viewport.attr("data-resizing","onxy")}).drag(function(e,t){i.$viewport.trigger("resize",{width:Math.max(i.settings.resize.minWidth,t.width+t.deltaX*2),height:Math.max(i.settings.resize.minHeight,t.height+t.deltaY)})}).drag("dragend",function(e,t){i.$viewport.attr("data-resizing",null)})}},y()};i.settings={classNamePrefix:"resizer",container:{switcher:"header",viewport:"article"},viewports:{auto:{width:"100%",height:"100%",description:"Auto"},optional:{description:"Optional"},mobile:{width:320,height:480,description:"Mobile"},tablet:{width:460,height:640,description:"Tablet"},notebook:{width:768,height:1024,description:"Notebook"},desktop:{width:1200,height:800,description:"Desktop"}},resize:{minWidth:240,minHeight:320}},i.addViewport=function(e,t){i.viewports.slug=t}})(window,document,jQuery);