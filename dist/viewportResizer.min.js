/*! ViewportResizer - v0.1.0 - 2012-10-12
* https://github.com/KaptinLin/ViewportResizer
* Copyright (c) 2012 KaptinLin; Licensed CC BY-NC 3.0 */
(function(e,t,n,r){"use strict";function i(e){return(typeof e=="string"||typeof e=="number")&&!isNaN(e-0)&&e!==""}function s(e){if(i(e))return e/2;if(typeof e=="string"&&e.charAt(e.length-1)=="%")return e.substr(0,e.length-1)/2+"%"}var o=n.ViewportResizer=function(t){function S(){o.$viewport=n("<div />").addClass(m).appendTo(o.settings.container.viewport),o.current={},p.build(),u.build(),a.build(),l.build(),c.build(),h.build(),p.bind(),u.bind(),a.bind(),l.bind(),c.bind(),h.bind(),f.init(o.settings.target),o.$viewport.attr("data-current","auto")}function x(e){return e=="auto"?{width:"100%",height:"100%"}:{width:o.settings.viewports[e].width+d,height:o.settings.viewports[e].height}}function T(){var e=jQuery('<div style="width: 100%; height:200px;">test</div>'),t=jQuery('<div style="width:200px; height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(e),n=e[0],r=t[0];jQuery("body").append(r);var i=n.offsetWidth;t.css("overflow","scroll");var s=r.clientWidth;return t.remove(),i-s}n.extend(o.settings,t);var u,a,f,l,c,h,p,d=T(),v=o.settings.classNamePrefix+"-switcher",m=o.settings.classNamePrefix+"-viewport",g=o.settings.classNamePrefix+"-iframe",y=o.settings.classNamePrefix+"-resizable",b=o.settings.classNamePrefix+"-axis",w=o.settings.classNamePrefix+"-info",E=o.settings.classNamePrefix+"-target";o.query={},e.onpopstate=function(e){e.state!==null&&e.state.viewport!==r&&switchTo(e.state.viewport,!1)},f={init:function(e){n.extend(o.query,f.getQuery()),o.query.viewport!==r&&o.settings.viewports[o.query.viewport]!==r&&u.to(o.query.viewport),o.query.target!==r?a.load(o.query.target):e!==r&&a.load(e)},pushState:function(t){if(e.history&&e.history.pushState&&e.history.replaceState){var r=[];n.each(t,function(e,t){r.push(e+"="+t)});var i="?"+r.join("&");e.history.pushState(t,"",i)}},getQuery:function(t){t===r&&(t=e.location.href);var i={},s=t.replace(/#[^\s]+/,"").split("?")[1];return s!==r&&(s=s.split("&"),n.each(s,function(e,t){var n=t.split("=");i[n[0]]=n[1]})),i}},p={build:function(){},bind:function(){}},u={build:function(){o.$switcher=n("<ul/>").addClass(v);var e=[];n.each(o.settings.viewports,function(t,n){t=="optional"?e+="<li data-viewport='"+t+"' class='"+v+"-"+t+"'>"+"<a href='#'>"+n.description+"</a>"+"<div class='"+v+"-optional-detail'><ul>"+"<li><label for='optional_width'>Width:</label><input type='number' id='optional_width' min='"+o.settings.min.width+"' value='' /></li>"+"<li><label for='optional_height'>Height:</label><input type='number' id='optional_height' min='"+o.settings.min.height+"' value='' /></li>"+"</ul></div>"+"</li>":e+="<li data-viewport='"+t+"' class='"+v+"-"+t+"'><a href='#'>"+n.description+"</a></li>"}),o.$switcher.append(e).appendTo(o.settings.container.switcher),o.$optional=o.$switcher.children('[data-viewport="optional"]'),u.$optional_width=o.$optional.find("#optional_width"),u.$optional_height=o.$optional.find("#optional_height")},to:function(e){o.current.viewport=e;var t=x(o.current.viewport);o.current.width=t.width,o.current.height=t.height,o.$switcher.children('[data-current="true"]').attr("data-current",null),o.$switcher.children('[data-viewport="'+e+'"]').attr("data-current","true"),o.$viewport.trigger("resize",o.current)},bind:function(){o.$switcher.delegate("a","click",function(e){var t=n(this).parent().data("viewport");t==="optional"&&u.showOptional(),u.to(t),e.preventDefault()}),u.$optional_width.on("change",function(){i(this.value)&&(this.value<o.settings.min.width&&(this.value=o.settings.min.width),o.$viewport.trigger("resize",{width:this.value}))}),u.$optional_height.on("change",function(){i(this.value)&&(this.value<o.settings.min.height&&(this.value=o.settings.min.height),o.$viewport.trigger("resize",{height:this.value}))})},showOptional:function(){o.$optional.attr("data-show","true"),u.$optional_width.val(o.current.width),u.$optional_height.val(o.current.height)}},a={build:function(){o.$iframe=n("<iframe />").addClass(g).appendTo(o.$viewport)},bind:function(){o.$viewport.delegate(o.$iframe,"resize",function(e,t){var n={};r!=t.width&&(n.width=t.width,o.current.width=t.width),r!=t.height&&(n.height=t.height,o.current.height=t.height),e.data.css(n)})},load:function(e){-1===e.search(/http(s){0,1}:\/\//)&&(e="http://"+e),o.$iframe.attr("src",e)}},h={build:function(){o.$info=n('<div><div class="'+w+'-width"><span class="'+w+'-lable">Width: </span><span class="'+w+'-value"></span></div>'+'<div class="'+w+'-height"><span class="'+w+'-lable">Height: </span><span class="'+w+'-value"></span></div>'+"</div>").addClass(w).appendTo(o.$viewport),o.$infoWidth=o.$info.find("."+w+"-width ."+w+"-value"),o.$infoHeight=o.$info.find("."+w+"-height ."+w+"-value")},bind:function(){o.$viewport.delegate(o.$info,"resize",function(e,t){var n={};r!=t.width&&(n.marginLeft=s(t.width),o.$infoWidth.text(t.width-d)),r!=t.height&&(n.top=t.height,o.$infoHeight.text(t.height)),e.data.css(n)})}},c={build:function(){o.$axis=n("<div />").addClass(b),o.$axisX=n("<div />").addClass(b+"-x").prependTo(o.$axis),o.$axisY=n("<div />").addClass(b+"-y").prependTo(o.$axis),o.$axis.prependTo(o.$viewport)},bind:function(){o.$viewport.delegate(o.$axisX,"resize",function(e,t){r!=t.width&&e.data.css({marginLeft:s(t.width)})}),o.$viewport.delegate(o.$axisY,"resize",function(e,t){r!=t.height&&e.data.css({top:t.height})})}},l={build:function(){o.$resizable=n("<div />").addClass(y),o.$resizableX=n("<div />").addClass(y+"-x").prependTo(o.$resizable),o.$resizableY=n("<div />").addClass(y+"-y").prependTo(o.$resizable),o.$resizableXY=n("<div />").addClass(y+"-xy").prependTo(o.$resizable),o.$resizable.prependTo(o.$viewport)},bind:function(){o.$viewport.delegate(o.$resizable,"resize",function(e,t){var n={};r!=t.width&&(n.width=t.width,n.marginLeft=s("-"+t.width)),r!=t.height&&(n.height=t.height),e.data.css(n)}),o.$resizableX.drag("start",function(e,t){t.width=o.current.width,o.$viewport.attr("data-resizing","onx")}).drag(function(e,t){o.$viewport.trigger("resize",{width:Math.max(o.settings.min.width,t.width+t.deltaX*2)})}).drag("dragend",function(e,t){o.$viewport.attr("data-resizing",null)}),o.$resizableY.drag("start",function(e,t){t.height=o.current.height,o.$viewport.attr("data-resizing","ony")}).drag(function(e,t){o.$viewport.trigger("resize",{height:Math.max(o.settings.min.height,t.height+t.deltaY)})}).drag("dragend",function(e,t){o.$viewport.attr("data-resizing",null)}),o.$resizableXY.drag("start",function(e,t){t.width=o.current.width,t.height=o.current.height,o.$viewport.attr("data-resizing","onxy")}).drag(function(e,t){o.$viewport.trigger("resize",{width:Math.max(o.settings.min.width,t.width+t.deltaX*2),height:Math.max(o.settings.min.height,t.height+t.deltaY)})}).drag("dragend",function(e,t){o.$viewport.attr("data-resizing",null)})}},S()};o.settings={classNamePrefix:"resizer",container:{switcher:"header",viewport:"article"},viewports:{auto:{width:"100%",height:"100%",description:"Auto"},optional:{description:"Optional"},mobile:{width:320,height:480,description:"Mobile"},tablet:{width:460,height:640,description:"Tablet"},notebook:{width:768,height:1024,description:"Notebook"},desktop:{width:1200,height:800,description:"Desktop"}},min:{width:240,height:320}},o.addViewport=function(e,t){o.viewports.slug=t}})(window,document,jQuery);