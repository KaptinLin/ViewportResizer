/*! ViewportResizer - v0.1.0 - 2012-10-16
* https://github.com/KaptinLin/ViewportResizer
* Copyright (c) 2012 KaptinLin; Licensed CC BY-NC 3.0 */
(function(e,t,n,r){"use strict";function i(e){return(typeof e=="string"||typeof e=="number")&&!isNaN(e-0)&&e!==""}function s(e){if(i(e))return e/2;if(typeof e=="string"&&e.charAt(e.length-1)=="%")return e.substr(0,e.length-1)/2+"%"}var o=n.ViewportResizer=function(t){function S(){o.$viewport=n("<div />").addClass(m).appendTo(o.settings.container.viewport),o.current={},p.build(),u.build(),a.build(),l.build(),c.build(),h.build(),p.bind(),u.bind(),a.bind(),l.bind(),c.bind(),h.bind(),f.init(o.settings.target),o.$viewport.attr("data-current","auto")}function x(e){return e=="auto"?{width:"100%",height:"100%"}:{width:o.settings.viewports[e].width,height:o.settings.viewports[e].height}}function T(){var e=jQuery('<div style="width: 100%; height:200px;">test</div>'),t=jQuery('<div style="width:200px; height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(e),n=e[0],r=t[0];jQuery("body").append(r);var i=n.offsetWidth;t.css("overflow","scroll");var s=r.clientWidth;return t.remove(),i-s}n.extend(o.settings,t);var u,a,f,l,c,h,p,d=T(),v=o.settings.classNamePrefix+"-switcher",m=o.settings.classNamePrefix+"-viewport",g=o.settings.classNamePrefix+"-iframe",y=o.settings.classNamePrefix+"-resizable",b=o.settings.classNamePrefix+"-axis",w=o.settings.classNamePrefix+"-info",E=o.settings.classNamePrefix+"-target";o.query={},f={init:function(t){n.extend(o.query,f.getQuery()),f.go(o.query),e.onpopstate=function(t){e.onpopstateing=!0,t.state!==null&&f.go(t.state),e.onpopstateing=!1,t.preventDefault()}},go:function(e){if(e.viewport!==r)if(e.viewport=="optional"){var t={width:e.width?parseInt(e.width):o.settings.min.width,height:e.height?parseInt(e.height):o.settings.min.height};u.to("optional",t),u.optional.activeMatch(t)}else o.settings.viewports[e.viewport]!==r&&u.to(e.viewport);e.target!==r?(p.set(e.target),a.load(e.target)):url!==r&&(p.set(url),a.load(url))},pushState:function(t){if(e.onpopstateing===!0)return;if(e.history&&e.history.pushState&&e.history.replaceState){var r=[];n.each(t,function(e,t){t!=null&&r.push(e+"="+t)});var i="?"+r.join("&");e.history.pushState(t,"",i)}},getQuery:function(t){t===r&&(t=e.location.href);var i={},s=t.replace(/#[^\s]+/,"").split("?")[1];return s!==r&&(s=s.split("&"),n.each(s,function(e,t){var n=t.split("=");i[n[0]]=n[1]})),i},setQuery:function(e){e=n.extend(o.query,e),f.pushState(e)}},p={build:function(){o.$target=n("<div/>").addClass(E),p.input=n('<input type="text"/>').addClass(E+"-input").val(o.settings.targetPlaceholder).appendTo(o.$target),p.enter=n("<span/>").addClass(E+"-enter").appendTo(o.$target),o.$target.appendTo(o.settings.container.target)},bind:function(){p.input.on("focus",function(){this.value==o.settings.targetPlaceholder&&(this.value="")}).on("blur",function(){this.value==""&&(this.value=o.settings.targetPlaceholder)}),p.input.on("change",function(){p.go(this.value)}),p.input.autoGrowInput({comfortZone:60,maxWidth:2e3})},set:function(e){p.input.val(e),p.input.trigger("update")},go:function(e){a.load(e)}},u={optional:{build:function(){u.$optional=o.$switcher.children('[data-viewport="optional"]'),u.optional.$container=n("<div/>").addClass(v+"-optional-container"),u.optional.$custom=n("<div class='"+v+"-optional-add'>"+"<div><label for='optional_width'>Width:</label><input type='number' id='optional_width' min='"+o.settings.min.width+"' value='' /></div>"+"<div><label for='optional_height'>Height:</label><input type='number' id='optional_height' min='"+o.settings.min.height+"' value='' /></div>"+"<div><button id='optional_add'>Add</button>"+"</div>").appendTo(u.optional.$container),u.optional.$width=u.optional.$custom.find("#optional_width"),u.optional.$height=u.optional.$custom.find("#optional_height"),u.optional.$add=u.optional.$custom.find("#optional_add"),u.optional.$saved=n("<ul/>").appendTo(u.optional.$container),u.optional.$container.appendTo(u.$optional)},activeMatch:function(e,t){var r=!1;return n(u.optional.$saved).children().each(function(){parseInt(n(this).data("width"))==e.width&&parseInt(n(this).data("height"))==e.height&&(n(this).trigger("click"),r=!0)}),r},addToSaved:function(e){i(e.width)&&i(e.height)&&u.optional.activeMatch(e)==0&&n("<li><div><span>Width: </span><span>"+e.width+"</span></div><div><span>Height: </span><span>"+e.height+"</span></div><div><button>Delete</button></div></li>").data("width",e.width).data("height",e.height).appendTo(u.optional.$saved).trigger("click")},active:function(e){n(e).attr("data-current","true"),n(e).siblings('[data-current="true"]').attr("data-current",null);var t=parseInt(n(e).data("width")),r=parseInt(n(e).data("height"));u.to("optional",{width:t,height:r})},deactive:function(){u.optional.$saved.find('[data-current="true"]').attr("data-current",null)},bind:function(){o.$optional.hover(function(e){o.$optional.attr("data-show","true"),i(o.current.width)&&u.optional.$width.val(o.current.width),i(o.current.height)&&u.optional.$height.val(o.current.height)},function(e){o.$optional.attr("data-show","false")}),u.optional.$width.on("change",function(){i(this.value)&&(this.value<o.settings.min.width&&(this.value=o.settings.min.width),o.$viewport.trigger("resize",{width:this.value}))}),u.optional.$height.on("change",function(){i(this.value)&&(this.value<o.settings.min.height&&(this.value=o.settings.min.height),o.$viewport.trigger("resize",{height:this.value}))}),u.optional.$add.on("click",function(){u.optional.addToSaved({width:u.optional.$width.val(),height:u.optional.$height.val()})}),u.optional.$saved.delegate("button","click",function(e){n(this).closest("li").remove()}),u.optional.$saved.delegate("li","click",function(e){u.optional.active(this)})}},build:function(){o.$switcher=n("<ul/>").addClass(v);var e=[];n.each(o.settings.viewports,function(t,n){e+="<li data-viewport='"+t+"' class='"+v+"-"+t+"'><a href='#'>"+n.description+"</a></li>"}),o.$switcher.append(e).appendTo(o.settings.container.switcher),o.$optional=o.$switcher.children('[data-viewport="optional"]'),u.optional.build()},to:function(e,t){o.current.viewport=e,e!="optional"&&(u.optional.deactive(),t=x(o.current.viewport)),o.current.width=t.width,o.current.height=t.height,e=="optional"?f.setQuery({viewport:e,width:t.width,height:t.height}):o.query.viewport!=e&&f.setQuery({viewport:e,width:null,height:null}),o.$switcher.children('[data-current="true"]').attr("data-current",null),o.$switcher.children('[data-viewport="'+e+'"]').attr("data-current","true"),o.$viewport.trigger("resize",o.current)},bind:function(){o.$switcher.delegate("a","click",function(e){var t=n(this).parent().data("viewport");t!=="optional"&&u.to(t),e.preventDefault()}),u.optional.bind()}},a={build:function(){o.$iframe=n("<iframe />").addClass(g).appendTo(o.$viewport)},bind:function(){o.$viewport.delegate(o.$iframe,"resize",function(e,t){var n={};r!=t.width&&(o.settings.scrollbarInWidth||!i(t.width)?n.width=t.width:n.width=t.width+d,o.current.width=t.width),r!=t.height&&(n.height=t.height,o.current.height=t.height),e.data.css(n)})},load:function(e){-1===e.search(/http(s){0,1}:\/\//)&&(e="http://"+e),o.$iframe.attr("src",e),o.query.target!=e&&f.setQuery({target:e})}},h={build:function(){o.$info=n('<div><div class="'+w+'-width"><span class="'+w+'-lable">Width: </span><span class="'+w+'-value"></span></div>'+'<div class="'+w+'-height"><span class="'+w+'-lable">Height: </span><span class="'+w+'-value"></span></div>'+"</div>").addClass(w).appendTo(o.$viewport),o.$infoWidth=o.$info.find("."+w+"-width ."+w+"-value"),o.$infoHeight=o.$info.find("."+w+"-height ."+w+"-value")},bind:function(){o.$viewport.delegate(o.$info,"resize",function(e,t){var n={};r!=t.width&&(n.marginLeft=s(t.width),o.$infoWidth.text(t.width)),r!=t.height&&(n.top=t.height,o.$infoHeight.text(t.height)),e.data.css(n)})}},c={build:function(){o.$axis=n("<div />").addClass(b),o.$axisX=n("<div />").addClass(b+"-x").prependTo(o.$axis),o.$axisY=n("<div />").addClass(b+"-y").prependTo(o.$axis),o.$axis.prependTo(o.$viewport)},bind:function(){o.$viewport.delegate(o.$axisX,"resize",function(e,t){if(r!=t.width){var n=t.width;if(!o.settings.scrollbarInWidth||!i(t.width))n=t.width+d;e.data.css({marginLeft:s(n)})}}),o.$viewport.delegate(o.$axisY,"resize",function(e,t){r!=t.height&&e.data.css({top:t.height})})}},l={build:function(){o.$resizable=n("<div />").addClass(y),o.$resizableX=n("<div />").addClass(y+"-x").prependTo(o.$resizable),o.$resizableY=n("<div />").addClass(y+"-y").prependTo(o.$resizable),o.$resizableXY=n("<div />").addClass(y+"-xy").prependTo(o.$resizable),o.$resizable.appendTo(o.$viewport)},bind:function(){o.$viewport.delegate(o.$resizable,"resize",function(e,t){var n={};if(r!=t.width){var u=t.width;if(!o.settings.scrollbarInWidth||!i(t.width))u=t.width+d;n.width=u,n.marginLeft=s("-"+u)}r!=t.height&&(n.height=t.height),e.data.css(n)}),o.$resizableX.drag("start",function(e,t){t.width=o.current.width,o.$viewport.attr("data-resizing","onx")}).drag(function(e,t){o.$viewport.trigger("resize",{width:Math.max(o.settings.min.width,t.width+t.deltaX*2)})}).drag("dragend",function(e,t){o.$viewport.attr("data-resizing",null)}),o.$resizableY.drag("start",function(e,t){t.height=o.current.height,o.$viewport.attr("data-resizing","ony")}).drag(function(e,t){o.$viewport.trigger("resize",{height:Math.max(o.settings.min.height,t.height+t.deltaY)})}).drag("dragend",function(e,t){o.$viewport.attr("data-resizing",null)}),o.$resizableXY.drag("start",function(e,t){t.width=o.current.width,t.height=o.current.height,o.$viewport.attr("data-resizing","onxy")}).drag(function(e,t){o.$viewport.trigger("resize",{width:Math.max(o.settings.min.width,t.width+t.deltaX*2),height:Math.max(o.settings.min.height,t.height+t.deltaY)})}).drag("dragend",function(e,t){o.$viewport.attr("data-resizing",null)})}},S()};o.settings={classNamePrefix:"resizer",container:{switcher:"header",target:"header",viewport:"article"},viewports:{auto:{width:"100%",height:"100%",description:"Auto"},optional:{description:"Optional"},mobile:{width:320,height:480,description:"Mobile"},tablet:{width:460,height:640,description:"Tablet"},notebook:{width:768,height:1024,description:"Notebook"},desktop:{width:1200,height:800,description:"Desktop"}},min:{width:240,height:320},targetPlaceholder:"Type your url here",scrollbarInWidth:!1},o.addViewport=function(e,t){o.viewports.slug=t}})(window,document,jQuery),function(e){e.fn.autoGrowInput=function(t){return t=e.extend({maxWidth:1e3,minWidth:0,comfortZone:70},t),this.filter("input:text").each(function(){var n=t.minWidth||e(this).width(),r="",i=e(this),s=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),u=function(){if(r===(r=i.val()))return;var e=r.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");s.html(e);var u=s.width(),a=u+t.comfortZone>=n?u+t.comfortZone:n,f=i.width(),l=a<f&&a>=n||a>n&&a<t.maxWidth;l&&i.width(a)};s.insertAfter(i),e(this).bind("keyup keydown blur update",u)}),this}}(jQuery);